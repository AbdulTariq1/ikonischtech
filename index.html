<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IKONISCH TECH | White-Label Scaling Partner for Agencies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom Colors: Red, Black, Yellow */
        :root {
            --color-primary: #dc2626; /* CTA Red (Tailwind red-600) */
            --color-secondary: #facc15; /* Highlight Yellow (Tailwind yellow-400) */
            --color-dark: #1f2937; /* Background Black (Tailwind gray-800) */
            --color-light: #f9fafb; /* Light Background */
        }

        .text-red { color: var(--color-primary); }
        .bg-red { background-color: var(--color-primary); }
        .text-yellow { color: var(--color-secondary); }
        .bg-yellow { background-color: var(--color-secondary); }
        .bg-dark { background-color: var(--color-dark); }

        /* Button styling */
        .btn-cta {
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
        }
        .btn-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.6);
        }
        
        /* Loading spinner */
        .spinner {
            border-top-color: #facc15;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Time slot specific styling */
        .time-slot:not(.bg-red):hover {
            background-color: #facc151a; /* yellow/10 */
        }
        
        /* Calendar cell styling */
        #calendar-grid > div:not(.bg-red):not(.bg-gray-700\/50):hover {
            background-color: #dc26261a; /* red/10 */
        }
    </style>
</head>
<body class="text-gray-800 bg-white antialiased">

    <!-- Header & Navigation -->
    <header class="shadow-xl sticky top-0 bg-white z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <a href="#" class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-red rounded-lg flex items-center justify-center font-extrabold text-white text-xl">IT</div>
                    <span class="font-bold text-2xl tracking-tight text-gray-900">IKONISCH <span class="text-red">TECH</span></span>
                </a>
                <nav class="hidden md:flex space-x-8 items-center text-sm font-medium">
                    <a href="#calculator" class="text-gray-600 hover:text-red transition duration-150">Profit Calculator</a>
                    <a href="#aigenerator" class="text-gray-600 hover:text-red transition duration-150">AI Value Generator</a>
                    <a href="#booking-consultation" class="text-gray-600 hover:text-red transition duration-150">Book Consultation</a>
                    <a href="#booking-consultation" class="bg-red text-white px-5 py-2 rounded-full font-semibold transition duration-300 btn-cta">
                        Start Your Scale
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- HERO SECTION -->
    <section class="pt-24 pb-36 bg-dark text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center max-w-4xl mx-auto">
                <p class="uppercase text-yellow font-bold mb-3 tracking-widest">The Agency Scaling Engine</p>
                <h1 class="text-5xl sm:text-6xl font-extrabold tracking-tight mb-6 leading-tight">
                    Scale to <span class="text-red">7-Figures</span> with Predictable White-Label Execution
                </h1>
                <p class="text-xl text-gray-300 mb-10 max-w-3xl mx-auto">
                    Stop worrying about hiring, training, and overhead. IKONISCH TECH provides turnkey delivery for your B2B, HVAC, Dental, and E-commerce clients.
                </p>
                <a href="#calculator" class="bg-red text-white px-10 py-4 rounded-full font-bold text-lg btn-cta">
                    Calculate Your Profit Jump â†’
                </a>
            </div>
        </div>
    </section>

    <!-- COST & REVENUE CALCULATOR SECTION (Enhanced Design) -->
    <section id="calculator" class="py-24 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <p class="uppercase text-red font-semibold mb-2">The Predictable Path</p>
                <h2 class="text-4xl font-bold text-gray-900">White-Label Profit Calculator</h2>
                <p class="text-lg text-gray-500 mt-2">See exactly how much you save and gain by outsourcing development and execution to us.</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-12 bg-white p-10 rounded-xl shadow-2xl border-t-8 border-red/50">
                <!-- Inputs -->
                <div class="space-y-6">
                    <h3 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-4 flex items-center">
                        <span class="text-red mr-3 text-2xl">ðŸ“Š</span> Input Your Current Metrics
                    </h3>
                    
                    <div>
                        <label for="clients" class="block text-sm font-medium text-gray-700 mb-1">Number of Active Clients Needing Execution</label>
                        <input type="number" id="clients" value="5" min="1" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-red focus:border-red shadow-sm" oninput="calculateProfit()">
                    </div>
                    
                    <div>
                        <label for="revenue" class="block text-sm font-medium text-gray-700 mb-1">Average Monthly Revenue per Client ($)</label>
                        <input type="number" id="revenue" value="2500" min="100" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-red focus:border-red shadow-sm" oninput="calculateProfit()">
                    </div>
                    
                    <div>
                        <label for="managementOverhead" class="block text-sm font-medium text-gray-700 mb-1">Current Internal Management Overhead per Client ($)</label>
                        <input type="number" id="managementOverhead" value="400" min="50" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-red focus:border-red shadow-sm" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">This covers your existing non-execution costs (e.g., reporting, billing).</p>
                    </div>

                    <!-- Plan Selection Radios -->
                    <div class="pt-4 border-t border-gray-200">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Select IKONISCH Plan for Simulation</label>
                        <div class="space-y-3">
                            <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                                <input type="radio" name="ikonischPlan" value="2999" data-clients="3" class="form-radio text-red h-4 w-4" checked onchange="calculateProfit()">
                                <span class="font-semibold text-gray-800">Starter Engine: $2,999/mo (50 Hrs - Up to 3 Clients)</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                                <input type="radio" name="ikonischPlan" value="5999" data-clients="6" class="form-radio text-red h-4 w-4" onchange="calculateProfit()">
                                <span class="font-semibold text-gray-800">Growth Accelerator: $5,999/mo (100 Hrs - Up to 6 Clients)</span>
                            </label>
                            <label class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                                <input type="radio" name="ikonischPlan" value="9999" data-clients="10" class="form-radio text-red h-4 w-4" onchange="calculateProfit()">
                                <span class="font-semibold text-gray-800">Enterprise Base: $9,999/mo (160 Hrs - Up to 10 Clients)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div class="space-y-6 bg-gray-800 p-8 rounded-xl shadow-inner border border-red/50 text-white">
                    <h3 class="text-2xl font-bold border-b border-gray-600 pb-3 mb-4 flex items-center text-yellow">
                        <span class="text-yellow mr-3 text-2xl">ðŸš€</span> Your IKONISCH Impact Analysis
                    </h3>

                    <!-- Key Comparison Metric -->
                    <div class="p-3 rounded-lg bg-red-700/30 border-2 border-red-500">
                        <p class="text-sm text-yellow font-medium mb-1">Cost Comparison (Hiring vs. Outsourcing Execution):</p>
                        <div class="flex justify-between items-center text-xl font-bold">
                            <p class="text-gray-300">Your Internal Execution Cost/Client:</p>
                            <p id="trueExecutionCost" class="text-red-400">$1,388</p>
                        </div>
                        <div class="flex justify-between items-center text-xl font-bold mt-2">
                            <p class="text-gray-300">IKONISCH Execution Cost/Client:</p>
                            <p id="ikonischCostPerClient" class="text-yellow">$999</p>
                        </div>
                        <p id="costSavingsLine" class="text-xs text-gray-400 mt-2 text-center">
                            **You save $389 (28%) per client on specialized execution costs immediately.**
                        </p>
                    </div>

                    <!-- Current Metrics -->
                    <div class="p-3 rounded-lg bg-gray-700">
                        <p class="text-sm text-gray-400 font-medium mb-1">Current Monthly Net Profit (With Management & Execution Overhead):</p>
                        <div class="flex justify-between items-center">
                            <p id="currentProfit" class="text-3xl font-extrabold text-red">$3,860</p>
                            <p class="text-xs text-gray-400">($<span id="totalRevenueSmall">12,500</span> Revenue - $<span id="totalOverheadSmall">8,640</span> Cost)</p>
                        </div>
                    </div>
                    
                    <!-- Projected Metrics with IKONISCH -->
                    <div class="p-3 rounded-lg bg-red-700/30 border-2 border-red-500">
                        <p class="text-sm text-yellow font-medium mb-1">Projected Net Profit with Selected Plan (<span id="selectedPlanName">Starter Engine</span>):</p>
                        <div class="flex justify-between items-center">
                            <p id="newProfit" class="text-4xl font-extrabold text-yellow">$9,501</p>
                            <p class="text-xs text-gray-300">($<span id="totalRevenueProjectedSmall">12,500</span> Revenue - $<span id="ikonischCostSmall">2,999</span> Cost)</p>
                        </div>
                    </div>

                    <div class="pt-4 text-center border-t border-gray-700">
                        <p id="profitDifference" class="text-xl font-bold text-gray-200">
                            Your potential profit **increases** by $3,001 per month, eliminating all execution risk.
                        </p>
                    </div>

                    <!-- Recommendation Section -->
                    <div id="recommendation-box" class="mt-8 p-4 rounded-lg bg-yellow/20 border-l-4 border-yellow text-gray-100">
                         <p class="text-lg font-bold text-yellow mb-2">ðŸ’¡ Recommended Plan: Growth Accelerator</p>
                         <p id="recommendation-text" class="text-sm">
                            Based on your 5 active clients, the Growth Accelerator plan provides the optimal balance of capacity (up to 6 clients) and cost efficiency, resulting in a higher net profit than your current internal structure.
                         </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- AI VALUE PROPOSITION GENERATOR SECTION -->
    <section id="aigenerator" class="py-24 bg-dark text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16 max-w-3xl mx-auto">
                <p class="uppercase text-yellow font-semibold mb-2">Powered by Gemini AI</p>
                <h2 class="text-4xl font-bold">Instantly Generate Your Scaling Headline</h2>
                <p class="text-lg text-gray-400 mt-2">See how quickly you can market new services to your clients when IKONISCH handles the delivery.</p>
            </div>
            
            <div class="max-w-4xl mx-auto bg-gray-800 p-8 rounded-xl shadow-2xl border-t-4 border-yellow">
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div class="md:col-span-2">
                        <label for="nicheInput" class="block text-sm font-medium text-gray-300 mb-1">Target Niche (e.g., HVAC, SaaS, Dentists)</label>
                        <input type="text" id="nicheInput" value="High-End E-commerce" class="w-full p-3 rounded-lg border border-gray-700 bg-gray-700 text-white focus:ring-yellow focus:border-yellow">
                    </div>
                    <div>
                        <label for="serviceInput" class="block text-sm font-medium text-gray-300 mb-1">Service to Scale</label>
                        <input type="text" id="serviceInput" value="Custom CRM Development" class="w-full p-3 rounded-lg border border-gray-700 bg-gray-700 text-white focus:ring-yellow focus:border-yellow">
                    </div>
                </div>

                <button onclick="generateValueProp()" class="w-full bg-red text-white font-extrabold py-3 rounded-lg text-lg hover:bg-yellow hover:text-gray-900 transition duration-300 btn-cta">
                    Generate My Value Prop
                </button>

                <!-- Output Area -->
                <div class="mt-8 bg-gray-900 p-6 rounded-lg border border-gray-700">
                    <p class="text-sm font-medium text-yellow mb-2">Generated Headline:</p>
                    <div id="propOutput" class="text-2xl font-extrabold text-white min-h-[50px] flex items-center justify-center text-center">
                        Input your details and hit 'Generate' to see the power of AI-driven marketing.
                    </div>
                    <div id="loadingIndicator" class="hidden text-center mt-2">
                        <div class="spinner w-6 h-6 border-4 border-gray-500 border-solid rounded-full inline-block"></div>
                        <span class="ml-2 text-gray-400">Generating copy...</span>
                    </div>
                    <div id="errorIndicator" class="hidden text-center mt-2 p-2 bg-red-800/50 text-red-300 rounded-lg">
                        Error generating copy. Please check your API key and try again.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- BOOKING CALENDAR & PLANS SECTION -->
    <section id="booking-consultation" class="py-24 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <p class="uppercase text-red font-semibold mb-2">Next Step: Capacity Mapping</p>
                <h2 class="text-4xl font-bold text-gray-900">Book Your 30-Minute Partnership Consultation</h2>
            </div>
            
            <div class="grid lg:grid-cols-5 gap-8">
                <!-- Contact Form and Review -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-2xl border-t-4 border-red/30 space-y-6">
                    <h3 class="text-2xl font-bold text-gray-800 border-b pb-3">Your Contact Details</h3>
                    <form id="booking-form" class="space-y-4" onsubmit="event.preventDefault(); handleBookingSubmit();">
                        <!-- All fields are now explicitly marked as required -->
                        <input type="text" placeholder="Your Full Name (Agency Owner) (Required)" required class="w-full bg-gray-50 text-gray-800 p-3 rounded-lg border border-gray-300 focus:border-red focus:ring-red">
                        <input type="email" placeholder="Work Email (Required)" required class="w-full bg-gray-50 text-gray-800 p-3 rounded-lg border border-gray-300 focus:border-red focus:ring-red">
                        <input type="tel" placeholder="Phone Number (Required)" required class="w-full bg-gray-50 text-gray-800 p-3 rounded-lg border border-gray-300 focus:border-red focus:ring-red">
                        <input type="text" placeholder="Agency Website URL (Required)" required class="w-full bg-gray-50 text-gray-800 p-3 rounded-lg border border-gray-300 focus:border-red focus:ring-red">
                        
                        <!-- Revenue Dropdown (Required) -->
                        <select required class="w-full bg-gray-50 text-gray-800 p-3 rounded-lg border border-gray-300 focus:border-red focus:ring-red">
                            <option value="" disabled selected>Current Agency Monthly Revenue (required)</option>
                            <option value="under10k">Under $10,000</option>
                            <option value="10k-30k">$10,000 - $30,000</option>
                            <option value="30k-60k">$30,000 - $60,000 (Ideal Partner)</option>
                            <option value="60k+">$60,000+</option>
                        </select>
                    </form>

                    <!-- Review Box -->
                    <div class="p-4 bg-gray-800 text-white rounded-lg shadow-inner">
                        <p class="text-sm font-semibold text-yellow mb-1">Your Selected Scale Roadmap Time:</p>
                        <p class="text-xl font-bold text-white">
                            <span id="booking-review-date">---</span> at <span id="booking-review-time">---</span>
                        </p>
                        <p class="text-xs text-gray-400 mt-1 flex items-center">
                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 9.586V6z" clip-rule="evenodd"></path></svg>
                            Time Zone: <span id="local-timezone-display" class="font-semibold ml-1">Loading...</span>
                        </p>
                    </div>

                    <!-- Updated CTA Button -->
                    <button id="bookButton" onclick="handleBookingSubmit()" class="w-full bg-red text-white font-extrabold py-3 rounded-lg text-lg hover:bg-yellow hover:text-gray-900 transition duration-300 btn-cta shadow-red/30">
                        Secure My 30-Minute Scale Roadmap
                    </button>
                    
                    <div id="booking-success" class="hidden mt-4 p-4 bg-green-700 border border-green-400 text-white rounded-lg">
                        <p class="font-bold">Roadmap Secured!</p>
                        <p class="text-sm">We've reserved your slot and sent a meeting invite. We'll speak soon about scaling your agency!</p>
                    </div>
                     <div id="booking-error" class="hidden mt-4 p-4 bg-red-700 border border-red-400 text-white rounded-lg">
                        <p class="font-bold">Error!</p>
                        <p class="text-sm">Please ensure you have filled all form fields and selected a date and time slot.</p>
                    </div>
                </div>


                <!-- Calendar and Time Slots (Main Area) -->
                <div class="lg:col-span-3 bg-gray-800 p-8 rounded-xl shadow-2xl border-t-4 border-yellow grid md:grid-cols-2 gap-8">
                    
                    <!-- Left: Date Selection -->
                    <div>
                        <h4 class="text-xl font-bold text-yellow mb-4">1. Select Day</h4>
                        
                        <!-- Month Navigation -->
                        <div class="flex justify-between items-center mb-4 text-white">
                            <button type="button" onclick="changeMonth(-1)" class="p-2 rounded-full hover:bg-gray-700 transition">&larr;</button>
                            <h3 id="month-title" class="font-semibold text-lg"></h3>
                            <button type="button" onclick="changeMonth(1)" class="p-2 rounded-full hover:bg-gray-700 transition">&rarr;</button>
                        </div>

                        <!-- Day Names -->
                        <div class="grid grid-cols-7 text-xs font-semibold text-center text-gray-400 mb-2">
                            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                        </div>

                        <!-- Calendar Grid -->
                        <div id="calendar-grid" class="grid grid-cols-7 gap-2">
                            <!-- Cells generated by JS -->
                        </div>
                    </div>

                    <!-- Right: Time Slot Selection -->
                    <div class="border-l border-gray-700 pl-4">
                        <h4 class="text-xl font-bold text-yellow mb-2">2. Select Time</h4>
                        <p class="text-sm text-gray-400 mb-4">
                            Availability for <span id="selected-date-display" class="font-semibold text-white">Date not selected</span>
                        </p>
                        <div id="time-slot-column" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                            <p class="text-gray-400 text-sm p-4">Select a day on the left to see available times.</p>
                            <!-- Time slots populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-gray-900 py-10 text-center text-sm text-gray-400">
        <div class="max-w-7xl mx-auto px-4">
            <p class="mb-2">&copy; 2025 IKONISCH TECH. White-Label Agency Partner. All rights reserved.</p>
            <div class="flex justify-center space-x-4">
                <a href="#" class="hover:text-red">Confidentiality Agreement</a>
                <span class="text-gray-600">|</span>
                <a href="#" class="hover:text-red">Partner Terms</a>
            </div>
        </div>
    </footer>

    <script>
        // --- Global Configuration ---
        // PKT is UTC+5, so offset in minutes is 5 * 60 = 300
        const PKT_UTC_OFFSET_MINUTES = 300; 
        const AVAILABILITY_PKT = [
            // 4 AM to 12 PM PKT
            { startHour: 4, startMinute: 0, endHour: 12, endMinute: 0 }, 
            // 7 PM to 11 PM PKT
            { startHour: 19, startMinute: 0, endHour: 23, endMinute: 0 }, 
        ];
        
        // True cost of hiring a specialized execution resource internally, per client (used for comparison)
        // Assumption: $8,333/mo fully loaded salary / 6 clients capacity = $1,388/client
        const TRUE_INTERNAL_EXECUTION_COST_PER_CLIENT = 1388;


        // --- State Management ---
        let currentCalendarDate = new Date(); // Tracks the currently displayed month
        let selectedDate = null;
        let selectedTimeSlot = null;
        // User's offset from UTC. Note: TimezoneOffset is positive if local time is behind UTC.
        const localTimeOffsetMinutes = new Date().getTimezoneOffset(); 

        // --- Utility Functions ---

        /**
         * Converts PKT availability to the user's local time zone for the selected date.
         */
        function calculateLocalTimeSlots(date) {
            if (!date) return [];

            const slots = [];
            const interval = 30; // 30-minute slots (Consultation duration)

            // Normalize the selected date to midnight in local time
            const startOfDayLocal = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const startOfDayUTCTime = startOfDayLocal.getTime(); 

            AVAILABILITY_PKT.forEach(slot => {
                let pkTimeMinutes = slot.startHour * 60 + slot.startMinute;
                const endMinutes = slot.endHour * 60 + slot.endMinute;

                // Ensure the slot duration is accounted for in the loop boundary (endMinutes - interval)
                while (pkTimeMinutes <= endMinutes - interval) {
                    
                    // 1. Calculate the minutes difference from UTC based on PKT and Local offsets
                    // Total minutes from Local Midnight to get the current PKT time converted to local time
                    const totalOffsetMinutes = (pkTimeMinutes - PKT_UTC_OFFSET_MINUTES) + (localTimeOffsetMinutes);

                    // 2. Calculate the UTC timestamp for this slot
                    const slotUtcTimestamp = startOfDayUTCTime + (totalOffsetMinutes * 60000);
                    const slotDate = new Date(slotUtcTimestamp);
                    
                    // 3. Check if the slot is valid (not in the past)
                    if (slotDate > new Date()) {
                        
                        // Check if the converted slot time falls on the selected day or the immediate next day
                        const isNextDay = slotDate.getDate() !== date.getDate() || slotDate.getMonth() !== date.getMonth() || slotDate.getFullYear() !== date.getFullYear();

                        const timeFormatter = new Intl.DateTimeFormat('en-US', { 
                            hour: 'numeric', 
                            minute: 'numeric', 
                            hour12: true 
                        });
                        
                        slots.push({
                            time: timeFormatter.format(slotDate),
                            dateTime: slotDate.toISOString(), 
                            isNextDay: isNextDay,
                            // If the local time conversion makes it the next day, note it.
                            fullDisplay: timeFormatter.format(slotDate) + (isNextDay ? ' (Next Day)' : ''),
                        });
                    }

                    pkTimeMinutes += interval;
                }
            });

            // Sort by UTC timestamp and remove duplicates
            slots.sort((a, b) => new Date(a.dateTime).getTime() - new Date(b.dateTime).getTime());
            // Map ensures we only show unique time strings, ignoring the full ISO date which may vary by second
            const uniqueSlots = Array.from(new Map(slots.map(item => [item.time + item.isNextDay, item])).values());

            return uniqueSlots;
        }

        // --- Calendar Rendering and Interaction ---

        function renderCalendar() {
            const calendarContainer = document.getElementById('calendar-grid');
            if (!calendarContainer) return;

            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            // 0=Sun, 6=Sat (Day of the week of the first day of the month)
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normalize today for comparison

            // Update month title
            document.getElementById('month-title').textContent = currentCalendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            calendarContainer.innerHTML = '';
            
            // Fill initial blanks for days before the 1st
            for (let i = 0; i < firstDayOfMonth; i++) {
                calendarContainer.innerHTML += `<div class="p-2"></div>`;
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                date.setHours(0, 0, 0, 0); // Normalize date for comparison with today
                
                const isSelected = selectedDate && date.toDateString() === selectedDate.toDateString();
                const isPast = date < today; 
                
                let classNames = "p-3 rounded-lg cursor-pointer transition-colors text-center text-sm font-medium border";

                if (isPast) {
                    classNames += " bg-gray-700/50 text-gray-500 cursor-not-allowed border-gray-600";
                } else if (isSelected) {
                    classNames += " bg-red text-white border-red shadow-lg shadow-red/50";
                } else {
                    classNames += " hover:bg-red/20 text-white bg-gray-700 border-gray-600";
                }

                calendarContainer.innerHTML += `
                    <div 
                        data-date="${date.toISOString()}" 
                        class="${classNames}" 
                        onclick="${isPast ? '' : `selectDay('${date.toISOString()}')`}"
                    >
                        ${day}
                    </div>
                `;
            }
        }

        function selectDay(dateISOString) {
            const newDate = new Date(dateISOString);
            selectedDate = newDate;
            selectedTimeSlot = null; // Reset time selection

            renderCalendar();
            renderTimeSlots();
            
            // Update the selected date display and review box
            const dateDisplay = newDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            document.getElementById('selected-date-display').textContent = dateDisplay;
            document.getElementById('booking-review-date').textContent = dateDisplay;
            document.getElementById('booking-review-time').textContent = '---';
        }

        function changeMonth(delta) {
            // Adjust the month of the current calendar tracker
            const newDate = new Date(currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta));
            currentCalendarDate = newDate;
            renderCalendar();

            // Check if the previously selected date is still valid in the new month view
            if (!selectedDate || selectedDate.getMonth() !== newDate.getMonth()) {
                document.getElementById('time-slot-column').innerHTML = '<p class="text-gray-400 text-sm p-4">Select a day on the left to see available times.</p>';
                selectedDate = null;
                selectedTimeSlot = null;
                document.getElementById('selected-date-display').textContent = 'Date not selected';
                document.getElementById('booking-review-date').textContent = '---';
                document.getElementById('booking-review-time').textContent = '---';
            } else {
                renderTimeSlots(); 
            }
        }

        // --- Time Slot Rendering and Interaction ---

        function renderTimeSlots() {
            const timeSlotColumn = document.getElementById('time-slot-column');
            if (!selectedDate || !timeSlotColumn) {
                timeSlotColumn.innerHTML = '<p class="text-gray-400 text-sm p-4">Select a day on the left to see available times.</p>';
                return;
            }

            const slots = calculateLocalTimeSlots(selectedDate);
            timeSlotColumn.innerHTML = '';

            if (slots.length === 0) {
                timeSlotColumn.innerHTML = `<p class="text-gray-400 italic p-4 bg-gray-900 rounded-lg border border-red-800/50">
                    No available slots on this date (${selectedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}).
                </p>`;
                return;
            }

            slots.forEach((slot, index) => {
                const isSelected = selectedTimeSlot && selectedTimeSlot.dateTime === slot.dateTime;
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.setAttribute('data-slot-iso', slot.dateTime);
                btn.onclick = () => selectTime(slot);

                let classNames = 'time-slot w-full p-3 rounded-lg border-2 transition-all duration-200 text-sm font-medium';
                if (isSelected) {
                    classNames += ' bg-red text-white border-red shadow-lg shadow-red/50 transform scale-[1.02]';
                } else {
                    classNames += ' bg-gray-700 text-yellow border-gray-600 hover:bg-yellow/20 hover:text-yellow';
                }

                btn.className = classNames;
                btn.innerHTML = `
                    ${slot.time}
                    ${slot.isNextDay ? '<span class="block text-xs font-light opacity-70 mt-0.5">(Next Day)</span>' : ''}
                `;
                timeSlotColumn.appendChild(btn);
            });
        }

        function selectTime(slot) {
            selectedTimeSlot = slot;
            renderTimeSlots();
            
            // Update review section
            document.getElementById('booking-review-time').textContent = slot.fullDisplay;
            document.getElementById('booking-error').classList.add('hidden');
        }

        // --- Form Submission (Simulated) ---

        function handleBookingSubmit() {
            const successMessage = document.getElementById('booking-success');
            const errorMessage = document.getElementById('booking-error');
            const form = document.getElementById('booking-form');
            
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');

            // 1. Check if a date and time slot are selected
            if (!selectedDate || !selectedTimeSlot) {
                errorMessage.classList.remove('hidden');
                errorMessage.querySelector('p:last-child').textContent = "Please select an available date and time slot.";
                return;
            }
            
            // 2. Check form validity
            if (!form.checkValidity()) {
                errorMessage.classList.remove('hidden');
                errorMessage.querySelector('p:last-child').textContent = "Please ensure all required form fields are filled correctly.";
                form.reportValidity(); // Trigger native validation messages
                return;
            }

            // Simulate submission loading state
            document.getElementById('bookButton').textContent = 'Securing Roadmap...';
            document.getElementById('bookButton').disabled = true;

            // Log details (simulate sending data to a backend)
            console.log("Booking Confirmed! Slot:", selectedTimeSlot.dateTime, "Timezone:", Intl.DateTimeFormat().resolvedOptions().timeZone);

            setTimeout(() => {
                // Reset form and state
                form.reset();
                selectedDate = null;
                selectedTimeSlot = null;
                currentCalendarDate = new Date(); 
                initializeBooking(); // Re-render calendar and time slots

                document.getElementById('bookButton').textContent = 'Secure My 30-Minute Scale Roadmap';
                document.getElementById('bookButton').disabled = false;
                
                successMessage.classList.remove('hidden');
                
                // Clear review box
                document.getElementById('booking-review-date').textContent = '---';
                document.getElementById('booking-review-time').textContent = '---';

                successMessage.scrollIntoView({ behavior: 'smooth' });
            }, 1500);
        }

        // --- Calculator Logic ---
        
        const PLANS = [
            { name: "Starter Engine", cost: 2999, maxClients: 3, capacityHours: 50 }, 
            { name: "Growth Accelerator", cost: 5999, maxClients: 6, capacityHours: 100 },
            { name: "Enterprise Base", cost: 9999, maxClients: 10, capacityHours: 160 } 
        ];

        function calculateProfit() {
            const numClients = parseFloat(document.getElementById('clients').value) || 0;
            const revenuePerClient = parseFloat(document.getElementById('revenue').value) || 0;
            // The agency's existing cost for *management* (the $300-$500 part)
            const managementOverheadPerClient = parseFloat(document.getElementById('managementOverhead').value) || 0;
            
            const selectedPlanRadio = document.querySelector('input[name="ikonischPlan"]:checked');
            
            // Find the selected plan object based on the radio value
            const selectedPlanCost = parseFloat(selectedPlanRadio.value);
            const selectedPlan = PLANS.find(p => p.cost === selectedPlanCost);
            
            let selectedPlanName = selectedPlan.name;

            const totalRevenue = numClients * revenuePerClient;

            // 1. Calculate Current Profit (Agency's cost includes Management + True Execution Cost)
            const totalInternalExecutionCost = numClients * TRUE_INTERNAL_EXECUTION_COST_PER_CLIENT;
            const totalManagementOverhead = numClients * managementOverheadPerClient;
            const totalCurrentCost = totalInternalExecutionCost + totalManagementOverhead;
            const currentProfit = totalRevenue - totalCurrentCost;

            // 2. Calculate Projected Profit (Agency's cost includes IKONISCH Plan + Management Overhead)
            // When outsourcing, the agency still has their management overhead, but replaces execution cost with IKONISCH fee.
            const newProfit = totalRevenue - (selectedPlanCost + totalManagementOverhead);
            
            // --- UI Updates ---
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount);
            };

            // Comparison box updates
            document.getElementById('trueExecutionCost').textContent = formatCurrency(TRUE_INTERNAL_EXECUTION_COST_PER_CLIENT);
            document.getElementById('ikonischCostPerClient').textContent = formatCurrency(selectedPlanCost / selectedPlan.maxClients);
            const savings = TRUE_INTERNAL_EXECUTION_COST_PER_CLIENT - (selectedPlanCost / selectedPlan.maxClients);
            const savingsPercent = (savings / TRUE_INTERNAL_EXECUTION_COST_PER_CLIENT) * 100;
            document.getElementById('costSavingsLine').innerHTML = `
                **You save ${formatCurrency(Math.abs(savings))} (${savingsPercent.toFixed(0)}%) per client on specialized execution costs immediately.**
            `;
            
            document.getElementById('selectedPlanName').textContent = selectedPlanName;
            document.getElementById('currentProfit').textContent = formatCurrency(currentProfit);
            document.getElementById('newProfit').textContent = formatCurrency(newProfit);
            
            // Small text summaries
            document.getElementById('totalRevenueSmall').textContent = formatCurrency(totalRevenue).replace('$', '');
            document.getElementById('totalOverheadSmall').textContent = formatCurrency(totalCurrentCost).replace('$', '');
            document.getElementById('totalRevenueProjectedSmall').textContent = formatCurrency(totalRevenue).replace('$', '');
            document.getElementById('ikonischCostSmall').textContent = formatCurrency(selectedPlanCost + totalManagementOverhead).replace('$', '');


            const difference = newProfit - currentProfit;
            const profitDifferenceElement = document.getElementById('profitDifference');
            
            if (difference >= 0) {
                profitDifferenceElement.innerHTML = `Your potential profit **increases** by <span class="text-yellow font-extrabold">${formatCurrency(Math.abs(difference))}</span> per month, eliminating all hiring risk.`;
            } else {
                profitDifferenceElement.innerHTML = `Your current profit is <span class="text-red-400 font-extrabold">${formatCurrency(Math.abs(difference))}</span> higher, but outsourcing grants **guaranteed capacity** and eliminates payroll risk.`;
            }

            // Apply color coding for negative profits
            const currentProfitElement = document.getElementById('currentProfit');
            const newProfitElement = document.getElementById('newProfit');
            
            currentProfitElement.classList.remove('text-red-400', 'text-yellow');
            newProfitElement.classList.remove('text-red-400', 'text-yellow');

            if (currentProfit < 0) { currentProfitElement.classList.add('text-red-400'); } else { currentProfitElement.classList.add('text-yellow'); }
            if (newProfit < 0) { newProfitElement.classList.add('text-red-400'); } else { newProfitElement.classList.add('text-yellow'); }

            // Recommendation Logic (same as before, find the cheapest plan that covers clients)
            let recommendedPlan = null;
            // Find the smallest plan that covers the client count
            for (const plan of PLANS) {
                if (numClients <= plan.maxClients) {
                    recommendedPlan = plan;
                    break;
                }
            }

            // Fallback if client count is too high, recommend largest
            if (!recommendedPlan) {
                recommendedPlan = PLANS[PLANS.length - 1]; // Still recommend the largest
            }

            const recBox = document.getElementById('recommendation-box');
            const recTitle = recBox.querySelector('p:first-child');
            const recText = document.getElementById('recommendation-text');
            
            const recPlanProjectedProfit = totalRevenue - (recommendedPlan.cost + totalManagementOverhead);
            const recProfitDelta = recPlanProjectedProfit - currentProfit;
            const profitDeltaText = formatCurrency(Math.abs(recProfitDelta));
            
            recTitle.innerHTML = `ðŸ’¡ Recommended Plan: ${recommendedPlan.name}`;

            if (numClients > recommendedPlan.maxClients) {
                 recText.innerHTML = `**WARNING: Capacity Alert.** Your ${numClients} clients exceed the recommended **${recommendedPlan.name}** capacity (${recommendedPlan.maxClients} clients). You should consider purchasing multiple plans or reaching out for a custom Enterprise quote.`;
            } else if (recommendedPlan.cost === selectedPlanCost) {
                recText.innerHTML = `**Your selection matches the optimal recommendation!** This plan effectively manages your ${numClients} clients (capacity up to ${recommendedPlan.maxClients}) while delivering specialized execution at a **${savingsPercent.toFixed(0)}% lower cost** than hiring internally.`;
            } else if (recProfitDelta >= 0) {
                 recText.innerHTML = `Based on your metrics, the **${recommendedPlan.name}** plan is optimal. It manages your ${numClients} clients (capacity up to ${recommendedPlan.maxClients}) and projects a profit increase of **${profitDeltaText}** over your current internal costs.`;
            } else {
                recText.innerHTML = `The **${recommendedPlan.name}** plan is recommended to meet your **capacity needs** (handles up to ${recommendedPlan.maxClients} clients). While your profit difference is **${recProfitDelta >= 0 ? 'increase' : 'decrease'} of ${profitDeltaText}**, it eliminates the massive risk and cost of hiring internally, freeing up your team to sell.`;
            }
        }
        
        // --- Gemini LLM Integration Logic ---
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Implements exponential backoff for API calls
        async function fetchWithBackoff(payload, maxRetries = 5) {
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        return await response.json();
                    } else if (response.status === 429 || response.status >= 500) {
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        if (attempt < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue;
                        }
                    }
                    throw new Error(`API call failed with status: ${response.statusText}`);
                } catch (error) {
                    if (attempt === maxRetries - 1) {
                        throw error;
                    }
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        async function generateValueProp() {
            const niche = document.getElementById('nicheInput').value;
            const service = document.getElementById('serviceInput').value;
            const propOutput = document.getElementById('propOutput');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const errorIndicator = document.getElementById('errorIndicator');

            if (!niche || !service) {
                propOutput.textContent = "Please enter both a niche and a service.";
                return;
            }

            propOutput.innerHTML = '';
            errorIndicator.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');

            const systemPrompt = "You are a world-class white-label B2B copywriter for a high-end digital outsourcing partner (IKONISCH TECH). Your goal is to write a single, punchy, persuasive headline (under 15 words) that convinces a marketing agency to outsource execution of a specific service in a specific niche. Focus on capacity, speed, and profit.";
            const userQuery = `Write a headline for an agency that needs to scale its white-label delivery of '${service}' for clients in the '${niche}' niche.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const result = await fetchWithBackoff(payload);
                const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (generatedText) {
                    // Clean up potential surrounding quotes from the model's structured response
                    propOutput.textContent = generatedText.trim().replace(/^['"]|['"]$/g, ''); 
                } else {
                    propOutput.textContent = "Could not generate headline. Response was empty.";
                    errorIndicator.classList.remove('hidden');
                }

            } catch (error) {
                console.error("Gemini API Error:", error);
                propOutput.textContent = "Failed to connect to the AI engine.";
                errorIndicator.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        // --- Initialization ---
        function initializeBooking() {
            renderCalendar();
            // Display local time zone information
            document.getElementById('local-timezone-display').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            calculateProfit();
            initializeBooking();
        });
    </script>
</body>
</html>


